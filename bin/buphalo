#!/usr/bin/env bash
# Bash instructions to Buphalo.

cd "$(dirname "$0")" || exit
cd ..

export Neighborhoods_Buphalo_V1_TemplateTree_Map_Builder_FactoryInterface__TemplateTreeDirectoryPaths=default:$PWD/vendor/neighborhoods/buphalo/template-tree/V1,diagnostic:$PWD/vendor/neighborhoods/throwable-diagnostic-component/template-tree/V1,worker:$PWD/template-tree/V1
export Neighborhoods_Buphalo_V1_FabricationFile_Map_BuilderInterface__FinderFileNames="*.buphalo.v1.fabrication.yml"

# shellcheck disable=SC2034
Neighborhoods_Buphalo_V1_TargetApplication_BuilderInterface__SourceDirectoryPath=$PWD/src \
Neighborhoods_Buphalo_V1_TargetApplication_BuilderInterface__FabricationDirectoryPath=$PWD/fab \
Neighborhoods_Buphalo_V1_TargetApplication_BuilderInterface__NamespacePrefix=Neighborhoods\\KojoWorkerDecoratorComponent\\ \
vendor/bin/buphalo

# shellcheck disable=SC2034
Neighborhoods_Buphalo_V1_TargetApplication_BuilderInterface__SourceDirectoryPath=$PWD/WorkerV1/src \
Neighborhoods_Buphalo_V1_TargetApplication_BuilderInterface__FabricationDirectoryPath=$PWD/WorkerV1/fab \
Neighborhoods_Buphalo_V1_TargetApplication_BuilderInterface__NamespacePrefix=Neighborhoods\\KojoWorkerDecoratorComponent\\WorkerV1\\ \
vendor/bin/buphalo

# Loop over all decorators and fabricate each
for DECORATOR_FOLDER in $PWD/WorkerDecoratorsV1/*/ ; do
  DECORATOR_NAME=$(basename $DECORATOR_FOLDER)
  # shellcheck disable=SC2034
  Neighborhoods_Buphalo_V1_TargetApplication_BuilderInterface__SourceDirectoryPath=$DECORATOR_FOLDER/src \
  Neighborhoods_Buphalo_V1_TargetApplication_BuilderInterface__FabricationDirectoryPath=$DECORATOR_FOLDER/fab \
  Neighborhoods_Buphalo_V1_TargetApplication_BuilderInterface__NamespacePrefix=Neighborhoods\\KojoWorkerDecoratorComponent\\WorkerDecoratorsV1\\$DECORATOR_NAME\\ \
  vendor/bin/buphalo
done;

composer dump-autoload
